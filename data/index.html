<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Smart Greenhouse</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#8BC34A 0%,#689F38 50%,#558B2F 100%);min-height:100vh;padding:10px;color:#333}
.container{max-width:1200px;margin:0 auto;background:rgba(255,255,255,0.95);border-radius:15px;box-shadow:0 8px 25px rgba(46,125,50,0.2);padding:20px}
.header{text-align:center;margin-bottom:25px;background:linear-gradient(135deg,#2E7D32,#388E3C,#4CAF50);color:white;padding:20px;border-radius:12px}
.main-title{font-size:2em;margin-bottom:8px;font-weight:700}
.subtitle{font-size:0.95em;opacity:0.9}
.status-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:15px;margin-bottom:20px}
.card{background:rgba(255,255,255,0.95);border-radius:12px;padding:18px;text-align:center;transition:.3s;border-left:4px solid #4CAF50}
.card:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(76,175,80,0.2)}
.card-icon{font-size:2em;margin-bottom:8px;color:#4CAF50}
.card-title{font-size:0.95em;color:#2E7D32;margin-bottom:5px;font-weight:600}
.card-value{font-size:1.8em;font-weight:700;color:#2E7D32;margin-bottom:2px}
.card-unit{color:# 558B2F;font-size:0.85em;margin-bottom:4px}
.card-status{font-size:.75em;font-weight:600;padding:4px 8px;border-radius:10px;display:inline-block}
.ok{background:linear-gradient(135deg,#4CAF50,#66BB6A);color:white}
.na{background:linear-gradient(135deg,#FF9800,#FFB74D);color:white}
.charts-section{margin-top:15px;background:rgba(255,255,255,0.95);border-radius:12px;padding:15px;border-left:4px solid #4CAF50}
.charts-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:15px}
.chart-container{background:white;border-radius:10px;padding:12px;box-shadow:0 3px 12px rgba(76,175,80,0.1);border-left:3px solid #4CAF50}
.chart-title{text-align:center;margin-bottom:8px;font-size:0.9em;font-weight:600;color:#2E7D32}
.chart-wrapper{position:relative;height:220px}
.watering-section{margin-top:20px;background:rgba(255,255,255,0.95);border-radius:12px;padding:20px;border-left:4px solid #03A9F4}
.watering-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:15px;margin-bottom:15px}
.watering-card{background:white;border-radius:10px;padding:18px;text-align:center;border-left:3px solid #03A9F4}
.toggle-switch{position:relative;display:inline-block;width:60px;height:30px;margin:15px 0}
.toggle-switch input{opacity:0;width:0;height:0}
.toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#ccc;border-radius:30px;transition:.3s}
.toggle-slider:before{content:'';position:absolute;height:22px;width:22px;left:4px;bottom:4px;background:white;border-radius:50%;transition:.3s}
.toggle-switch input:checked+.toggle-slider{background:#4CAF50}
.toggle-switch input:checked+.toggle-slider:before{transform:translateX(30px)}
.led-circle{width:40px;height:40px;border-radius:50%;margin:0 auto 10px;box-shadow:0 2px 8px rgba(0,0,0,0.2)}
.led-red{background:radial-gradient(circle,#FF5252,#E53935);box-shadow:0 0 15px rgba(229,57,53,0.6)}
.led-green{background:radial-gradient(circle,#4CAF50,#388E3C);box-shadow:0 0 15px rgba(76,175,80,0.6)}
.manual-water-btn{background:linear-gradient(135deg,#03A9F4,#0288D1);color:white;border:none;padding:12px 24px;border-radius:10px;font-weight:600;cursor:pointer;margin:15px 0;transition:.3s}
.manual-water-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(3,169,244,0.3)}
.manual-water-btn:disabled{background:#ccc;cursor:not-allowed;opacity:0.6}
.footer{margin-top:20px;text-align:center;color:white;font-size:0.85em;background:linear-gradient(135deg,#2E7D32,#388E3C);padding:12px;border-radius:10px}
.footer a{color:#C8E6C9;text-decoration:none;font-weight:600}
@media (max-width:768px){
  body{padding:5px}
  .container{padding:12px}
  .status-cards,.charts-grid,.watering-grid{grid-template-columns:1fr}
  .chart-wrapper{height:200px}
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1 class="main-title">Smart Greenhouse</h1>
    <p class="subtitle">Î£ÏÏƒÏ„Î·Î¼Î± Î Î±ÏÎ±ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎ·Ï‚ Î¦Ï…Ï„ÏÎ½</p>
  </div>
  
  <div class="status-cards">
    <div class="card">
      <div class="card-icon">ğŸŒ¡ï¸</div>
      <div class="card-title">Î˜ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î±</div>
      <div class="card-value" id="temperature">--</div>
      <div class="card-unit">Â°C</div>
      <div class="card-status ok">Î•ÎÎ•Î¡Î“ÎŸÎ£</div>
    </div>
    
    <div class="card">
      <div class="card-icon">ğŸ“Š</div>
      <div class="card-title">Î‘Ï„Î¼Î¿ÏƒÏ†Î±Î¹ÏÎ¹ÎºÎ® Î Î¯ÎµÏƒÎ·</div>
      <div class="card-value" id="pressure">--</div>
      <div class="card-unit">hPa</div>
      <div class="card-status ok">Î•ÎÎ•Î¡Î“ÎŸÎ£</div>
    </div>
    
    <div class="card">
      <div class="card-icon">â˜€ï¸</div>
      <div class="card-title">Î¦Ï‰Ï„Î¹ÏƒÎ¼ÏŒÏ‚</div>
      <div class="card-value" id="light">--</div>
      <div class="card-unit">lux</div>
      <div class="card-status" id="lightStatus">--</div>
    </div>
    
    <div class="card">
      <div class="card-icon">ğŸŒ±</div>
      <div class="card-title">Î¥Î³ÏÎ±ÏƒÎ¯Î± Î•Î´Î¬Ï†Î¿Ï…Ï‚</div>
      <div class="card-value" id="soil">--</div>
      <div class="card-unit">%</div>
      <div class="card-status" id="soilStatus">--</div>
    </div>
  </div>
  
  <div class="charts-section">
    <h3 style="color:#2E7D32;margin-bottom:10px">Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚</h3>
    <div class="charts-grid" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr))">
      <div style="background:white;border-radius:10px;padding:15px;border-left:3px solid #4CAF50">
        <div style="color:#2E7D32;font-size:0.85em;margin-bottom:5px">Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ·</div>
        <div id="systemLastUpdate" style="font-size:1.3em;font-weight:700;color:#2E7D32">--</div>
      </div>
      <div style="background:white;border-radius:10px;padding:15px;border-left:3px solid #4CAF50">
        <div style="color:#2E7D32;font-size:0.85em;margin-bottom:5px">Î£ÏÎ½Î¿Î»Î¿ ÎšÎ±Ï„Î±Î³ÏÎ±Ï†ÏÎ½</div>
        <div id="totalReadings" style="font-size:1.3em;font-weight:700;color:#2E7D32">0</div>
      </div>
      <div style="background:white;border-radius:10px;padding:15px;border-left:3px solid #4CAF50">
        <div style="color:#2E7D32;font-size:0.85em;margin-bottom:5px">Î•Î»Î¬Ï‡Î¹ÏƒÏ„Î· Î˜ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î±</div>
        <div id="minTemp" style="font-size:1.3em;font-weight:700;color:#2E7D32">--</div>
      </div>
      <div style="background:white;border-radius:10px;padding:15px;border-left:3px solid #4CAF50">
        <div style="color:#2E7D32;font-size:0.85em;margin-bottom:5px">ÎœÎ­Î³Î¹ÏƒÏ„Î· Î˜ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î±</div>
        <div id="maxTemp" style="font-size:1.3em;font-weight:700;color:#2E7D32">--</div>
      </div>
    </div>
  </div>
  
  <div class="charts-section">
    <h3 style="color:#2E7D32;margin-bottom:10px">Î™ÏƒÏ„Î¿ÏÎ¹ÎºÎ¬ Î”ÎµÎ´Î¿Î¼Î­Î½Î± (Î–Ï‰Î½Ï„Î±Î½Î¬)</h3>
    <div class="charts-grid">
      <div class="chart-container">
        <h3 class="chart-title">Î˜ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î±</h3>
        <div class="chart-wrapper"><canvas id="tempChart"></canvas></div>
      </div>
      <div class="chart-container">
        <h3 class="chart-title">Î Î¯ÎµÏƒÎ·</h3>
        <div class="chart-wrapper"><canvas id="pressChart"></canvas></div>
      </div>
      <div class="chart-container">
        <h3 class="chart-title">Î¦Ï‰Ï„Î¹ÏƒÎ¼ÏŒÏ‚</h3>
        <div class="chart-wrapper"><canvas id="lightChart"></canvas></div>
      </div>
      <div class="chart-container">
        <h3 class="chart-title">Î¥Î³ÏÎ±ÏƒÎ¯Î± Î•Î´Î¬Ï†Î¿Ï…Ï‚</h3>
        <div class="chart-wrapper"><canvas id="soilChart"></canvas></div>
      </div>
    </div>
  </div>
  
  <div class="watering-section">
    <h3 style="color:#01579B;margin-bottom:15px">ğŸ’§ Î£ÏÏƒÏ„Î·Î¼Î± Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î¿Ï… Î Î¿Ï„Î¯ÏƒÎ¼Î±Ï„Î¿Ï‚</h3>
    <div class="watering-grid">
      <div class="watering-card">
        <span style="font-size:2em">ğŸ’§</span>
        <div style="color:#01579B;font-weight:600;margin:10px 0">Î‘Î½Ï„Î»Î¯Î± ÎÎµÏÎ¿Ï</div>
        <div style="margin:15px 0">
          <div class="led-circle led-red" id="ledCircle"></div>
          <span id="ledLabel" style="font-weight:600">OFF</span>
        </div>
        <div class="card-status" id="pumpStatus" style="font-size:0.85em;color:#666">Î‘Î½ÎµÎ½ÎµÏÎ³ÏŒ</div>
      </div>
      
      <div class="watering-card" style="border-left-color:#4CAF50">
        <span style="font-size:2em">ğŸ¤–</span>
        <div style="color:#2E7D32;font-weight:600;margin:10px 0">Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î¿ Î Î¿Ï„Î¹ÏƒÎ¼Î±</div>
        <label class="toggle-switch">
          <input type="checkbox" id="autoWateringToggle" onchange="toggleAutoWatering()">
          <span class="toggle-slider"></span>
        </label>
        <div class="card-status" id="autoStatus" style="font-size:0.85em;color:#666">Î‘Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿</div>
      </div>
      
      <div class="watering-card" style="border-left-color:#FF9800">
        <span style="font-size:2em">ğŸš¿</span>
        <div style="color:#E65100;font-weight:600;margin:10px 0">Î§ÎµÎ¹ÏÎ¿ÎºÎ¹Î½Î·Ï„Î¿ Î Î¿Ï„Î¹ÏƒÎ¼Î±</div>
        <button class="manual-water-btn" id="manualWaterBtn" onclick="manualWatering()">
          ğŸ’§ Î Î¿Ï„Î¹ÏƒÎµ Î¤Ï‰ÏÎ± (15Î´)
        </button>
        <div class="card-status" style="font-size:0.85em;color:#666">Î Î±Ï„Î·ÏƒÎµ Î³Î¹Î± Ï€Î¿Ï„Î¹ÏƒÎ¼Î±</div>
      </div>
    </div>
    
    <div style="background:white;border-radius:10px;padding:18px;border-left:3px solid #9C27B0;margin-top:15px">
      <h4 style="color:#6A1B9A;margin-bottom:12px">âš™ï¸ Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î¿Ï… Î Î¿Ï„Î¯ÏƒÎ¼Î±Ï„Î¿Ï‚</h4>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px">
        <div>
          <label style="display:block;color:#6A1B9A;font-weight:600;margin-bottom:6px">ğŸ”» Î•Î½Î±ÏÎ¾Î· ÎšÎ±Ï„Ï‰ Î‘Ï€ÏŒ (%)</label>
          <input type="number" id="soilMinInput" value="30" min="0" max="100" onchange="updateWateringThresholds()" 
                 style="width:100%;padding:10px;border:2px solid #9C27B0;border-radius:8px;font-size:1em">
        </div>
        <div>
          <label style="display:block;color:#6A1B9A;font-weight:600;margin-bottom:6px">ğŸ”º Î£Ï„Î±Î¼Î¬Ï„Î·Î¼Î± Î Î±Î½Ï‰ Î‘Ï€ÏŒ (%)</label>
          <input type="number" id="soilMaxInput" value="90" min="0" max="100" onchange="updateWateringThresholds()" 
                 style="width:100%;padding:10px;border:2px solid #9C27B0;border-radius:8px;font-size:1em">
        </div>
      </div>
      <p style="color:#666;font-size:0.85em;margin-top:10px">
        ğŸ’¡ Î— Î±Î½Ï„Î»Î¯Î± Î¸Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÎ¹ ÏŒÏ„Î±Î½ Î· Ï…Î³ÏÎ±ÏƒÎ¯Î± Ï€Î­ÏƒÎµÎ¹ ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ Ï„Î¿ ÎµÎ»Î¬Ï‡Î¹ÏƒÏ„Î¿ ÎºÎ±Î¹ Î¸Î± ÏƒÏ„Î±Î¼Î±Ï„Î®ÏƒÎµÎ¹ ÏŒÏ„Î±Î½ Ï†Ï„Î¬ÏƒÎµÎ¹ Ï„Î¿ Î¼Î­Î³Î¹ÏƒÏ„Î¿
      </p>
    </div>
  </div>
  
  <div class="footer">
    <p>&copy; 2025 <a href="https://github.com/Mimisnak/SmartGreenhouse" target="_blank">Smart Greenhouse System</a> | 
       Developer by: <a href="https://mimis.dev" target="_blank">mimis.dev</a></p>
  </div>
</div>

<script>
var tempChart,pressChart,lightChart,soilChart;
var dataHistory={temperature:[],pressure:[],light:[],soil:[],timestamps:[]};
var wateringState={isWatering:false,autoMode:false,minThreshold:30,maxThreshold:90};

function makeChart(ctx,color,data){
  return new Chart(ctx,{
    type:'line',
    data:{
      labels:dataHistory.timestamps,
      datasets:[{
        data:data,
        borderColor:color,
        backgroundColor:color.replace('rgb','rgba').replace(')',',0.1)'),
        tension:0.3,
        fill:true,
        pointRadius:0
      }]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      plugins:{legend:{display:false}},
      scales:{
        y:{beginAtZero:false},
        x:{display:false}
      }
    }
  });
}

function initCharts(){
  var tc=document.getElementById('tempChart');
  var pc=document.getElementById('pressChart');
  var lc=document.getElementById('lightChart');
  var sc=document.getElementById('soilChart');
  if(tc)tempChart=makeChart(tc.getContext('2d'),'rgb(76,175,80)',dataHistory.temperature);
  if(pc)pressChart=makeChart(pc.getContext('2d'),'rgb(46,125,50)',dataHistory.pressure);
  if(lc)lightChart=makeChart(lc.getContext('2d'),'rgb(139,195,74)',dataHistory.light);
  if(sc)soilChart=makeChart(sc.getContext('2d'),'rgb(102,187,106)',dataHistory.soil);
}

function updateCharts(){
  if(tempChart){
    tempChart.data.labels=dataHistory.timestamps;
    tempChart.data.datasets[0].data=dataHistory.temperature;
    tempChart.update('none');
  }
  if(pressChart){
    pressChart.data.labels=dataHistory.timestamps;
    pressChart.data.datasets[0].data=dataHistory.pressure;
    pressChart.update('none');
  }
  if(lightChart){
    lightChart.data.labels=dataHistory.timestamps;
    lightChart.data.datasets[0].data=dataHistory.light;
    lightChart.update('none');
  }
  if(soilChart){
    soilChart.data.labels=dataHistory.timestamps;
    soilChart.data.datasets[0].data=dataHistory.soil;
    soilChart.update('none');
  }
}

function loadWateringStatus(){
  fetch('/water/status')
    .then(r=>r.json())
    .then(d=>{
      wateringState.isWatering=d.isWatering;
      wateringState.autoMode=d.autoEnabled;
      // Don't overwrite thresholds from user input
      // wateringState.minThreshold=d.minThreshold;
      // wateringState.maxThreshold=d.maxThreshold;
      updateWateringUI();
    })
    .catch(e=>{});
}

function updateWateringUI(){
  var led=document.getElementById('ledCircle');
  var lbl=document.getElementById('ledLabel');
  var pump=document.getElementById('pumpStatus');
  var autoToggle=document.getElementById('autoWateringToggle');
  var autoSt=document.getElementById('autoStatus');
  
  if(wateringState.isWatering){
    led.className='led-circle led-green';
    lbl.textContent='ON';
    pump.textContent='Î Î¿Ï„Î¯Î¶ÎµÎ¹';
  }else{
    led.className='led-circle led-red';
    lbl.textContent='OFF';
    pump.textContent='Î‘Î½ÎµÎ½ÎµÏÎ³ÏŒ';
  }
  
  autoToggle.checked=wateringState.autoMode;
  autoSt.textContent=wateringState.autoMode?'Î•Î½ÎµÏÎ³ÏŒ':'Î‘Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿';
  // Don't reset threshold inputs - keep user values
  // document.getElementById('soilMinInput').value=wateringState.minThreshold;
  // document.getElementById('soilMaxInput').value=wateringState.maxThreshold;
}

function toggleAutoWatering(){
  var enabled=document.getElementById('autoWateringToggle').checked;
  var min=parseInt(document.getElementById('soilMinInput').value);
  var max=parseInt(document.getElementById('soilMaxInput').value);
  
  wateringState.autoMode=enabled;
  wateringState.minThreshold=min;
  wateringState.maxThreshold=max;
  
  fetch('/water/auto',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      enabled:enabled,
      minThreshold:min,
      maxThreshold:max
    })
  })
  .then(r=>r.json())
  .then(d=>{
    console.log('Auto watering response:', d);
    wateringState.autoMode=d.autoMode;
    updateWateringUI();
  })
  .catch(e=>{
    console.error('Auto watering error:', e);
  });
}

function updateWateringThresholds(){
  var min=parseInt(document.getElementById('soilMinInput').value);
  var max=parseInt(document.getElementById('soilMaxInput').value);
  wateringState.minThreshold=min;
  wateringState.maxThreshold=max;
  
  if(wateringState.autoMode){
    fetch('/water/auto',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        enabled:true,
        minThreshold:min,
        maxThreshold:max
      })
    }).catch(e=>{});
  }
}

function manualWatering(){
  var btn=document.getElementById('manualWaterBtn');
  btn.disabled=true;
  btn.textContent='â³ Î Î¿Ï„Î¯Î¶ÎµÎ¹...';
  
  fetch('/water/manual',{method:'POST'})
    .then(r=>r.json())
    .then(d=>{
      setTimeout(()=>{
        btn.disabled=false;
        btn.textContent='ğŸ’§ Î Î¿Ï„Î¹ÏƒÎµ Î¤Ï‰ÏÎ± (15Î´)';
        loadWateringStatus();
      },15000);
    })
    .catch(e=>{
      btn.disabled=false;
      btn.textContent='ğŸ’§ Î Î¿Ï„Î¹ÏƒÎµ Î¤Ï‰ÏÎ± (15Î´)';
    });
}

function updateData(){
  fetch('/api')
    .then(r=>r.json())
    .then(d=>{
      // Update sensor values
      if(d.temperature>-900){
        document.getElementById('temperature').textContent=d.temperature.toFixed(1);
        dataHistory.temperature.push(d.temperature);
      }
      if(d.pressure>-900){
        document.getElementById('pressure').textContent=d.pressure.toFixed(1);
        dataHistory.pressure.push(d.pressure);
      }
      if(d.light>=0){
        document.getElementById('light').textContent=d.light.toFixed(0);
        document.getElementById('lightStatus').textContent='Î•ÎÎ•Î¡Î“ÎŸÎ£';
        document.getElementById('lightStatus').className='card-status ok';
        dataHistory.light.push(d.light);
      }else{
        document.getElementById('lightStatus').textContent='ÎœÎ— Î”Î™Î‘Î˜Î•Î£Î™ÎœÎŸÎ£';
        document.getElementById('lightStatus').className='card-status na';
      }
      if(d.soil>=0){
        document.getElementById('soil').textContent=d.soil.toFixed(0);
        document.getElementById('soilStatus').textContent='Î•ÎÎ•Î¡Î“ÎŸÎ£';
        document.getElementById('soilStatus').className='card-status ok';
        dataHistory.soil.push(d.soil);
      }else{
        document.getElementById('soilStatus').textContent='ÎœÎ— Î”Î™Î‘Î˜Î•Î£Î™ÎœÎŸÎ£';
        document.getElementById('soilStatus').className='card-status na';
      }
      
      // Update system info
      if(d.totalReadings){
        document.getElementById('totalReadings').textContent=d.totalReadings;
      }
      if(d.minTemperature && d.minTemperature<999){
        document.getElementById('minTemp').textContent=d.minTemperature.toFixed(1)+'Â°C';
      }
      if(d.maxTemperature && d.maxTemperature>-999){
        document.getElementById('maxTemp').textContent=d.maxTemperature.toFixed(1)+'Â°C';
      }
      
      // Update timestamps
      var now=new Date();
      var time=now.toLocaleTimeString();
      dataHistory.timestamps.push(time);
      
      // Keep only last 50 points
      if(dataHistory.timestamps.length>50){
        dataHistory.timestamps.shift();
        dataHistory.temperature.shift();
        dataHistory.pressure.shift();
        dataHistory.light.shift();
        dataHistory.soil.shift();
      }
      
      document.getElementById('systemLastUpdate').textContent=time;
      updateCharts();
      loadWateringStatus();
    })
    .catch(e=>{});
}

// Initialize
initCharts();
setInterval(updateData,5000);
updateData();
</script>
</body>
</html>